<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Einstein Advice</title>
    <style>
      body { font-family: Arial, sans-serif; margin: 16px; background: white; }
      .card { border: 0; border-radius: 12px; padding: 16px; max-width: 720px; }
      .accent { color: #364a6a; font-weight: 700; }
      ul { margin: 8px 0 16px 20px; padding: 0; }
      .title { font-size: 18px; margin-bottom: 10px; }
      .label { font-weight: 700; margin-top: 10px; }
      .small { font-size: 12px; color: #777; margin-top: 12px; }
    </style>
  </head>
  <body>
    <div class="card">
      <div class="title">
        <b>Einstein Scoring &amp; Update ðŸ’­</b>
        <span class="accent" id="score"></span>
      </div>

      <div class="label">ðŸŸ¢ <b>Top Positives</b></div>
      <ul id="positives"></ul>

      <div class="label">ðŸ”´ <b>Top Negatives</b></div>
      <ul id="negatives"></ul>

      <div class="small" id="updated"></div>
    </div>

    <script>
      const params = new URLSearchParams(location.search);
      const dealId = params.get("deal_id") || "TEST-1";
      const url = `./data/${encodeURIComponent(dealId)}.json`;

      fetch(url, { cache: "no-store" })
        .then(r => {
          if (!r.ok) throw new Error(`Missing data file: data/${dealId}.json`);
          return r.json();
        })
        .then(data => {
          document.getElementById("score").textContent = data.score ? `  Score ${data.score}` : "";

          const pos = document.getElementById("positives");
          pos.innerHTML = (data.positives || []).map(x => `<li>${escapeHtml(x)}</li>`).join("");

          const neg = document.getElementById("negatives");
          neg.innerHTML = (data.negatives || []).map(x => `<li><span class="accent">${escapeHtml(x)}</span></li>`).join("");

          document.getElementById("updated").textContent =
            data.updated_at ? `Last updated: ${data.updated_at}` : "";
        })
        .catch(err => {
          document.getElementById("positives").innerHTML = "";
          document.getElementById("negatives").innerHTML = `<li>${escapeHtml(err.message)}</li>`;
        });

      function escapeHtml(s) {
        return String(s).replace(/[&<>"']/g, c => ({
          "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
        }[c]));
      }
    </script>
  </body>
</html>
